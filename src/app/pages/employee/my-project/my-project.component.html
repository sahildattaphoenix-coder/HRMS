<div class="row g-4 h-100">
  <!-- Left Column: Project List -->
  <div class="col-lg-3 col-md-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-white border-bottom py-3">
        <h6 class="fw-bold m-0 text-primary">My Projects</h6>
      </div>
      <div
        class="list-group list-group-flush overflow-auto"
        style="max-height: calc(100vh - 200px)"
      >
        <button
          *ngFor="let p of projects"
          type="button"
          class="list-group-item list-group-item-action p-3 border-bottom"
          [class.active-project]="selectedProject?.id === p.id"
          [class.bg-light]="selectedProject?.id === p.id"
          (click)="selectProject(p)"
        >
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span
              class="badge rounded-pill"
              [ngClass]="{
                'bg-success': p.state === 'Completed',
                'bg-primary': p.state === 'Active',
                'bg-warning text-dark': p.state === 'Pending'
              }"
              >{{ p.state }}</span
            >
            <small class="text-muted" style="font-size: 0.7rem">{{
              p.deadline | date : "dd MM yyyy"
            }}</small>
          </div>
          <h6 class="fw-bold mb-1 ml-1 text-truncate" title="{{ p.title }}">
            {{ p.title }}
          </h6>
          <div class="d-flex align-items-center justify-content-between mt-2">
            <small class="text-muted">{{ p.category }}</small>
            <small class="fw-bold text-primary">{{ p.progress }}%</small>
          </div>
          <div class="progress mt-1" style="height: 4px">
            <div
              class="progress-bar bg-primary"
              role="progressbar"
              [style.width.%]="p.progress"
            ></div>
          </div>
        </button>

        <div *ngIf="projects.length === 0" class="p-4 text-center text-muted">
          <i class="bi bi-folder-x fs-1 opacity-50"></i>
          <p class="mt-2 small">No projects assigned.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column: Project Details -->
  <div class="col-lg-9 col-md-8">
    <div
      *ngIf="selectedProject; else noProjectSelected"
      class="bg-white rounded-4 shadow-sm p-4 h-100 overflow-auto"
    >
      <!-- Existing Detail View Logic -->
      <div
        class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3"
      >
        <div>
          <h5 class="fw-bold m-0 text-uppercase text-primary">
            {{ selectedProject.title }}
          </h5>
          <small class="text-muted"
            >Managed by {{ selectedProject.manager }}</small
          >
        </div>
        <span class="badge bg-primary fs-6 px-3 py-2 rounded-pill shadow-sm">{{
          selectedProject.state
        }}</span>
      </div>

      <div class="row align-items-center mb-5">
        <div class="col-md-4 text-center mb-3 mb-md-0">
          <!-- Progress Circle -->
          <div class="position-relative d-inline-block">
            <div
              class="progress-circle"
              [style.--value]="selectedProject.progress"
            >
              <div class="text-center">
                <h3 class="m-0 fw-bold">{{ selectedProject.progress }}%</h3>
                <small class="text-muted">Completed</small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="row g-3">
            <div class="col-6">
              <div class="p-3 rounded-3 bg-light border">
                <small class="text-muted d-block mb-1">Start Date</small>
                <div class="fw-bold">{{ selectedProject.startDate | date : "dd MM yyyy" }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 rounded-3 bg-light border">
                <small class="text-muted d-block mb-1">Deadline</small>
                <div class="fw-bold text-danger">
                  {{ selectedProject.deadline | date : "dd MM yyyy" }}
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="p-3 rounded-3 bg-light border">
                <small class="text-muted d-block mb-1">Team Members</small>
                <div class="d-flex flex-wrap gap-2 mt-1">
                  <app-avatar
                    *ngFor="let member of selectedProject.team"
                    [name]="member.name"
                    [imageUrl]="member.img"
                    [size]="35"
                    [fontSize]="'0.8rem'"
                    styleClass="rounded-circle border border-white shadow-sm"
                    title="{{ member.name }}"
                  >
                  </app-avatar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tasks Section -->
      <div class="mt-4 pt-4 border-top">
        <h6 class="fw-bold mb-3 d-flex align-items-center gap-2">
          <i class="bi bi-check2-square text-primary"></i> Tasks & To-Dos
        </h6>

        <div class="input-group mb-3 shadow-sm rounded-pill overflow-hidden">
          <input
            type="text"
            class="form-control border-0 bg-light px-4"
            placeholder="Add a new task..."
            [(ngModel)]="newTask"
            (keyup.enter)="addTask()"
          />
          <button class="btn btn-primary px-4" (click)="addTask()">
            <i class="bi bi-plus-lg"></i>
          </button>
        </div>

        <div class="list-group border-0 gap-2">
          <div
            *ngIf="!selectedProject.tasks || selectedProject.tasks.length === 0"
            class="p-4 text-center text-muted dashed-border rounded-3"
          >
            No tasks yet. Add one to get started!
          </div>

          <div
            *ngFor="let task of selectedProject.tasks"
            class="list-group-item border rounded-3 p-3 d-flex align-items-center justify-content-between shadow-sm hover-elevate transition-all"
          >
            <div class="form-check mb-0 d-flex align-items-center gap-2">
              <input
                class="form-check-input mt-0"
                type="checkbox"
                [checked]="task.completed"
                (change)="toggleTask(task)"
                id="task{{ task.id }}"
                style="width: 1.2em; height: 1.2em; cursor: pointer"
              />
              <label
                class="form-check-label user-select-none"
                [class.text-decoration-line-through]="task.completed"
                [class.text-muted]="task.completed"
                for="task{{ task.id }}"
                style="cursor: pointer"
              >
                {{ task.text }}
              </label>
            </div>
            <button
              class="btn btn-icon btn-sm text-muted hover-danger"
              (click)="deleteTask(task.id)"
            >
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noProjectSelected>
      <div
        class="h-100 d-flex flex-column align-items-center justify-content-center text-muted p-5 bg-white rounded-4 shadow-sm"
      >
        <i class="bi bi-clipboard-data fs-1 opacity-25 mb-3"></i>
        <h5>Select a project to view details</h5>
      </div>
    </ng-template>
  </div>
</div>

<style>
  .progress-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: radial-gradient(closest-side, white 79%, transparent 80% 100%),
      conic-gradient(#0d6efd calc(var(--value) * 1%), #e9ecef 0);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .active-project {
    border-left: 4px solid #0d6efd !important;
    background-color: #f8f9fa;
  }

  .dashed-border {
    border: 2px dashed #e2e8f0;
  }

  .hover-elevate:hover {
    transform: translateY(-2px);
  }

  .hover-danger:hover {
    color: #dc3545 !important;
    background: rgba(220, 53, 69, 0.1);
    border-radius: 50%;
  }

  .btn-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
</style>
